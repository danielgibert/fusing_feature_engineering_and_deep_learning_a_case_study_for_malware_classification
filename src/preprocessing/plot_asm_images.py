import argparse
from pe_parser.asm_parser import AssemblyParser
import matplotlib.pyplot as plt
import os

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('pe_filepath', type=str, help="PE filepath")
    parser.add_argument('output_filepath', type=str, help="Output filepath")
    args = parser.parse_args()

    for filename in os.listdir(args.pe_filepath)[:1000]:
        print(filename)
        asm_parser = AssemblyParser()
        asm_parser.load_asm_file(os.path.join(args.pe_filepath, filename))
        asm_img = asm_parser.convert_asm_to_img()

        plt.imshow(asm_img, cmap='gray', vmin=0, vmax=255)
        plt.savefig(os.path.join(args.output_filepath, filename)+".png")