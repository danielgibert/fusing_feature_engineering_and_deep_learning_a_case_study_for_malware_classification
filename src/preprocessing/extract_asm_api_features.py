import os
import csv
import argparse
from pe_parser.asm_parser import AssemblyParser


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('--train', dest='train', action='store_true')
    parser.add_argument('--no-train', dest='train', action='store_false')
    parser.set_defaults(train=True)
    args = parser.parse_args()

    if args.train is True:
        pe_filepath = "/mnt/hdd1/cerberus_mlw_data/asm/raw/train/"
        output_filepath = "../../data/feature_files/train/asm_api_features.csv"
    else:
        pe_filepath = "/mnt/hdd1/cerberus_mlw_data/asm/raw/test/"
        output_filepath = "../../data/feature_files/test/asm_api_features.csv"

    fieldnames = ['Id', 'ASM_API_wcslen', 'ASM_API___vbaUI1I2', 'ASM_API_send', 'ASM_API_MoveFileExA',
                  'ASM_API_VariantCopyInd', 'ASM_API___vbaStrI2', 'ASM_API_DispatchMessageW',
                  'ASM_API_WaitForMultipleObjects', 'ASM_API_CoGetClassObject', 'ASM_API_IsEqualGUID',
                  'ASM_API_GetUserNameA', 'ASM_API_GetWindowTextLengthA', 'ASM_API___vbaErase', 'ASM_API_WSAStartup',
                  'ASM_API_RegCreateKeyExW', 'ASM_API___vbaVarSub', 'ASM_API_GetOpenFileNameA',
                  'ASM_API_VirtualProtectEx', 'ASM_API_IsDBCSLeadByte', 'ASM_API_SetWindowLongW', 'ASM_API_time',
                  'ASM_API_wvsprintfA', 'ASM_API_*invalid*', 'ASM_API_GetDlgCtrlID', 'ASM_API___vbaLsetFixstr',
                  'ASM_API_CreateWindowExW', 'ASM_API___vbaAryVar', 'ASM_API___vbaExitProc',
                  'ASM_API___vbaFixstrConstruct', 'ASM_API_TextOutA', 'ASM_API_CreateDirectoryW',
                  'ASM_API_SuspendThread', 'ASM_API_DeviceIoControl', 'ASM_API_GetWindowLongW', 'ASM_API_GlobalSize',
                  'ASM_API_DefWindowProcW', 'ASM_API_DrawFocusRect', 'ASM_API_gethostbyname', 'ASM_API_GetErrorInfo',
                  'ASM_API__strlwr', 'ASM_API_HttpQueryInfoA', 'ASM_API___vbaI2Var', 'ASM_API_strncmp',
                  'ASM_API_PostMessageW', 'ASM_API_LocalFileTimeToFileTime', 'ASM_API_InternetConnectA',
                  'ASM_API__cexit', 'ASM_API_SHGetSpecialFolderPathA', 'ASM_API_htons', 'ASM_API_SetCursorPos',
                  'ASM_API_DeleteService', 'ASM_API_CharNextW', 'ASM_API_FindResourceW', 'ASM_API___vbaRedimPreserve',
                  'ASM_API_ValidateRect', 'ASM_API___vbaBoolVarNull', 'ASM_API_GetClassLongA', 'ASM_API_LPtoDP',
                  'ASM_API_PeekMessageW', 'ASM_API___vbaPutOwner3', 'ASM_API_socket', 'ASM_API_closesocket',
                  'ASM_API_CreateEventW', 'ASM_API_memmove', 'ASM_API_lstrcmpW', 'ASM_API_ClosePrinter',
                  'ASM_API_GetVersionExW', 'ASM_API_Netbios', 'ASM_API_CreateServiceA', 'ASM_API_StringFromCLSID',
                  'ASM_API_CLSIDFromProgID', 'ASM_API_GlobalMemoryStatus', 'ASM_API_EnumChildWindows',
                  'ASM_API_OpenPrinterA', 'ASM_API_ControlService', 'ASM_API_IsValidLocale', 'ASM_API_LoadLibraryExW',
                  'ASM_API_GetTimeFormatA', 'ASM_API_Shell_NotifyIconA', 'ASM_API_connect', 'ASM_API_lstrcpyW',
                  'ASM_API_DisableThreadLibraryCalls', 'ASM_API___vbaStrVarCopy', 'ASM_API___vbaInStrVar',
                  'ASM_API_wcscmp', 'ASM_API_SetViewportExtEx', 'ASM_API_SetWindowExtEx',
                  'ASM_API_InitCommonControlsEx', 'ASM_API_lstrcmpiW', 'ASM_API___vbaVarTstNe', 'ASM_API_wcscpy',
                  'ASM_API_ShellExecuteExA', 'ASM_API_HttpOpenRequestA', 'ASM_API_RegQueryValueA',
                  'ASM_API_HttpSendRequestA', 'ASM_API_fwrite', 'ASM_API___vbaGet3', 'ASM_API_recv',
                  'ASM_API_FormatMessageW', 'ASM_API_GetStartupInfoW', 'ASM_API___vbaVarZero',
                  'ASM_API_GlobalGetAtomNameA', 'ASM_API___vbaI4ErrVar', 'ASM_API_FindNextFileW',
                  'ASM_API_BringWindowToTop', 'ASM_API_FreeSid', 'ASM_API_CreateRectRgn', 'ASM_API_wsprintfW',
                  'ASM_API___vbaStrFixstr', 'ASM_API_GetUserDefaultLangID', 'ASM_API_TranslateAcceleratorA',
                  'ASM_API_CreateProcessW', 'ASM_API_Escape', 'ASM_API___vbaVarIndexLoad', 'ASM_API_RegDeleteValueW',
                  'ASM_API_Polyline', 'ASM_API_SetWindowTextW', 'ASM_API_LoadCursorW', 'ASM_API_inet_addr',
                  'ASM_API_CreateRemoteThread', 'ASM_API_GetThreadContext', 'ASM_API_InternetGetConnectedState',
                  'ASM_API_GetTextExtentPointA', 'ASM_API_UnlockFile', 'ASM_API_ShellExecuteW',
                  'ASM_API_GetSaveFileNameA', 'ASM_API_GetFileTitleA', 'ASM_API_EnumSystemLocalesA',
                  'ASM_API_GetTempPathW', 'ASM_API_GetTokenInformation', 'ASM_API_VerQueryValueW', 'ASM_API_CreatePipe',
                  'ASM_API_GdiFlush', 'ASM_API_GetWindowTextW', 'ASM_API___vbaRecAnsiToUni',
                  'ASM_API___vbaRecUniToAnsi', 'ASM_API_LockFile', 'ASM_API_keybd_event', 'ASM_API_SetServiceStatus',
                  'ASM_API_SetFileAttributesW', 'ASM_API_QueryServiceStatus', 'ASM_API_GetProcAddress',
                  'ASM_API_LoadLibraryA', 'ASM_API_GetModuleHandleA', 'ASM_API_ExitProcess', 'ASM_API_VirtualAlloc',
                  'ASM_API_WriteFile', 'ASM_API_GetModuleFileNameA', 'ASM_API_CloseHandle', 'ASM_API_RegCloseKey',
                  'ASM_API_VirtualFree', 'ASM_API_GetLastError', 'ASM_API_Sleep', 'ASM_API_CreateFileA',
                  'ASM_API_FreeLibrary', 'ASM_API_GetCommandLineA', 'ASM_API_MultiByteToWideChar', 'ASM_API_ReadFile',
                  'ASM_API_SetFilePointer', 'ASM_API_RegQueryValueExA', 'ASM_API_GetCurrentThreadId',
                  'ASM_API_GetTickCount', 'ASM_API_GetStdHandle', 'ASM_API_MessageBoxA', 'ASM_API_GetStartupInfoA',
                  'ASM_API_RegOpenKeyExA', 'ASM_API_GetCurrentProcess', 'ASM_API_EnterCriticalSection',
                  'ASM_API_LeaveCriticalSection', 'ASM_API_WideCharToMultiByte', 'ASM_API_DeleteCriticalSection',
                  'ASM_API_VirtualProtect', 'ASM_API_InitializeCriticalSection', 'ASM_API_LocalAlloc',
                  'ASM_API_FindClose', 'ASM_API_CreateThread', 'ASM_API_RtlUnwind', 'ASM_API_lstrlenA', 'ASM_API_GetDC',
                  'ASM_API_UnhandledExceptionFilter', 'ASM_API_WaitForSingleObject', 'ASM_API_GetLocaleInfoA',
                  'ASM_API_GetFileSize', 'ASM_API_FindFirstFileA', 'ASM_API_GetACP', 'ASM_API_DeleteFileA',
                  'ASM_API_GetVersionExA', 'ASM_API_GetVersion', 'ASM_API_GetCurrentProcessId', 'ASM_API_TlsSetValue',
                  'ASM_API_TlsGetValue', 'ASM_API_RaiseException', 'ASM_API_TerminateProcess', 'ASM_API_CharNextA',
                  'ASM_API_HeapAlloc', 'ASM_API_LocalFree', 'ASM_API_GetCPInfo', 'ASM_API_GetFileType',
                  'ASM_API_GlobalAlloc', 'ASM_API_HeapFree', 'ASM_API_VirtualQuery', 'ASM_API_DispatchMessageA',
                  'ASM_API_ShowWindow', 'ASM_API_SetEndOfFile', 'ASM_API_RegSetValueExA', 'ASM_API_DestroyWindow',
                  'ASM_API_CreateWindowExA', 'ASM_API_GetSystemMetrics', 'ASM_API_GlobalFree',
                  'ASM_API_InterlockedIncrement', 'ASM_API_InterlockedDecrement', 'ASM_API_LoadStringA',
                  'ASM_API_GetThreadLocale', 'ASM_API_SendMessageA', 'ASM_API_DeleteObject', 'ASM_API_GetTempPathA',
                  'ASM_API_GetClientRect', 'ASM_API_SelectObject', 'ASM_API_GetWindowRect', 'ASM_API_wsprintfA',
                  'ASM_API_SetLastError', 'ASM_API_QueryPerformanceCounter', 'ASM_API_GetSystemDirectoryA',
                  'ASM_API_DefWindowProcA', 'ASM_API_GlobalLock', 'ASM_API_GlobalUnlock', 'ASM_API_TranslateMessage',
                  'ASM_API_ShellExecuteA', 'ASM_API_HeapReAlloc', 'ASM_API_GetDeviceCaps', 'ASM_API_SetTimer',
                  'ASM_API_LoadCursorA', 'ASM_API_CreateFontIndirectA', 'ASM_API_CreateMutexA', 'ASM_API_GetClassInfoA',
                  'ASM_API_SetFocus', 'ASM_API_CreateCompatibleBitmap', 'ASM_API_CoTaskMemFree', 'ASM_API__initterm',
                  'ASM_API_EndDialog', 'ASM_API_KillTimer', 'ASM_API_CreatePopupMenu', 'ASM_API_RegDeleteValueA',
                  'ASM_API_GetForegroundWindow', 'ASM_API_FlushFileBuffers', 'ASM_API_TrackPopupMenu',
                  'ASM_API_GetSystemMenu', 'ASM_API_FindWindowA', 'ASM_API_OpenProcess', 'ASM_API_HeapSize',
                  'ASM_API_GetExitCodeProcess', 'ASM_API_GetClassNameA', 'ASM_API_DllFunctionCall',
                  'ASM_API_GetCursorPos', 'ASM_API_EVENT_SINK_Release', 'ASM_API_EVENT_SINK_QueryInterface',
                  'ASM_API_GetPrivateProfileStringA', 'ASM_API_EVENT_SINK_AddRef', 'ASM_API__adjust_fdiv',
                  'ASM_API_CallNextHookEx', 'ASM_API_GetMessageA', 'ASM_API_ImageList_Destroy', 'ASM_API_SetFileTime',
                  'ASM_API_GetObjectA', 'ASM_API_GetFocus', 'ASM_API_GetFileVersionInfoA', 'ASM_API_ImageList_Create',
                  'ASM_API_SaveDC', 'ASM_API_UnhookWindowsHookEx', 'ASM_API_SetStdHandle', 'ASM_API_RemoveDirectoryA',
                  'ASM_API_MoveFileA', 'ASM_API_GetFileVersionInfoSizeA', 'ASM_API_IsIconic',
                  'ASM_API_CreateBrushIndirect', 'ASM_API_EnumWindows', 'ASM_API_SetWindowsHookExA',
                  'ASM_API_CreateSolidBrush', 'ASM_API_exit', 'ASM_API_WritePrivateProfileStringA', 'ASM_API_free',
                  'ASM_API_FileTimeToLocalFileTime', 'ASM_API_InternetOpenA', 'ASM_API_OpenProcessToken',
                  'ASM_API_OleInitialize', 'ASM_API_GetKeyState', 'ASM_API_SetCurrentDirectoryA',
                  'ASM_API_GetModuleHandleW', 'ASM_API_OpenClipboard', 'ASM_API_GetActiveWindow',
                  'ASM_API_CloseClipboard', 'ASM_API_ClientToScreen', 'ASM_API_SetClassLongA', 'ASM_API_ExitWindowsEx',
                  'ASM_API_UnregisterClassA', 'ASM_API_FreeResource', 'ASM_API_RegisterWindowMessageA',
                  'ASM_API_GetShortPathNameA', 'ASM_API_ResetEvent', 'ASM_API__except_handler3', 'ASM_API_malloc',
                  'ASM_API_OleUninitialize', 'ASM_API_GetSubMenu', 'ASM_API_MapWindowPoints', 'ASM_API_GetMenu',
                  'ASM_API_GetTempFileNameA', 'ASM_API_RegEnumValueA', 'ASM_API_EmptyClipboard', 'ASM_API_GetDIBits',
                  'ASM_API_SetCapture', 'ASM_API_PtInRect', 'ASM_API_SetClipboardData', 'ASM_API_InternetCloseHandle',
                  'ASM_API_DestroyMenu', 'ASM_API_FindWindowExA', 'ASM_API_ReleaseCapture', 'ASM_API_VariantClear',
                  'ASM_API_GetSystemTime', 'ASM_API_CheckMenuItem', 'ASM_API_ResumeThread', 'ASM_API_GetMessagePos',
                  'ASM_API_SetRect', 'ASM_API_CoUninitialize', 'ASM_API_GetModuleFileNameW', 'ASM_API_GetCurrentThread',
                  'ASM_API_IsDebuggerPresent', 'ASM_API_InternetReadFile', 'ASM_API_SetActiveWindow',
                  'ASM_API_GetWindowDC', 'ASM_API_SysAllocStringLen', 'ASM_API_OffsetRect', 'ASM_API_DestroyIcon',
                  'ASM_API_GetMenuItemCount', 'ASM_API_DialogBoxParamA', 'ASM_API_DrawIcon', 'ASM_API_CreateBitmap',
                  'ASM_API_VariantCopy', 'ASM_API_GetWindowPlacement', 'ASM_API_GetCapture', 'ASM_API_memset',
                  'ASM_API_lstrlenW', 'ASM_API_RestoreDC', 'ASM_API_IsChild', 'ASM_API_GetEnvironmentVariableA',
                  'ASM_API_AdjustWindowRectEx', 'ASM_API_ExitThread', 'ASM_API_GetMenuState', 'ASM_API_SelectPalette',
                  'ASM_API_IsBadReadPtr', 'ASM_API_GlobalDeleteAtom', 'ASM_API_ImageList_Add',
                  'ASM_API_GetLastActivePopup', 'ASM_API_GetTopWindow', 'ASM_API___set_app_type',
                  'ASM_API_GetDateFormatA', 'ASM_API_SysReAllocStringLen', 'ASM_API_CreateFileW',
                  'ASM_API_RealizePalette', 'ASM_API_GetMenuItemID', 'ASM_API_InflateRect',
                  'ASM_API_SafeArrayPtrOfIndex', 'ASM_API__CIcos', 'ASM_API_GlobalReAlloc', 'ASM_API_PatBlt',
                  'ASM_API_SetViewportOrgEx', 'ASM_API_UnrealizeObject', 'ASM_API_GetPixel', 'ASM_API_SetPropA',
                  'ASM_API__allmul', 'ASM_API_LineTo', 'ASM_API_SetDlgItemTextA', 'ASM_API_GlobalHandle',
                  'ASM_API_memcpy', 'ASM_API_CreateProcessA', 'ASM_API_IsWindow', 'ASM_API_RegCreateKeyExA',
                  'ASM_API_SetWindowLongA', 'ASM_API_EnableWindow', 'ASM_API_GetWindowsDirectoryA',
                  'ASM_API_HeapCreate', 'ASM_API_PostQuitMessage', 'ASM_API_SetWindowPos', 'ASM_API_LoadResource',
                  'ASM_API_GetFileAttributesA', 'ASM_API_PeekMessageA', 'ASM_API_lstrcpynA', 'ASM_API_GetOEMCP',
                  'ASM_API_BeginPaint', 'ASM_API_EndPaint', 'ASM_API_SetErrorMode', 'ASM_API_SysFreeString',
                  'ASM_API_GetStringTypeW', 'ASM_API_lstrcpyA', 'ASM_API_SizeofResource', 'ASM_API_CallWindowProcA',
                  'ASM_API_IsWindowVisible', 'ASM_API_SetUnhandledExceptionFilter', 'ASM_API_LoadLibraryExA',
                  'ASM_API_GetWindowLongA', 'ASM_API_LCMapStringW', 'ASM_API_LCMapStringA', 'ASM_API_SetHandleCount',
                  'ASM_API_SetForegroundWindow', 'ASM_API_GetStringTypeA', 'ASM_API_GetProcessHeap',
                  'ASM_API_GetEnvironmentStringsW', 'ASM_API_GetSysColor', 'ASM_API_RegisterClassA',
                  'ASM_API_CreateDirectoryA', 'ASM_API_LockResource', 'ASM_API_FreeEnvironmentStringsA',
                  'ASM_API_InvalidateRect', 'ASM_API_FreeEnvironmentStringsW', 'ASM_API_InterlockedExchange',
                  'ASM_API_FindResourceA', 'ASM_API_SetTextColor', 'ASM_API_TlsAlloc', 'ASM_API_GetEnvironmentStrings',
                  'ASM_API_GetSystemTimeAsFileTime', 'ASM_API_BitBlt', 'ASM_API_SetCursor', 'ASM_API_VerQueryValueA',
                  'ASM_API_HeapDestroy', 'ASM_API_lstrcatA', 'ASM_API_CompareStringA', 'ASM_API_ReleaseDC',
                  'ASM_API_GetFullPathNameA', 'ASM_API_CoCreateInstance', 'ASM_API_MulDiv', 'ASM_API_GetWindowTextA',
                  'ASM_API_CopyFileA', 'ASM_API_FindNextFileA', 'ASM_API_lstrcmpiA', 'ASM_API_CreateEventA',
                  'ASM_API_FillRect', 'ASM_API_DeleteDC', 'ASM_API_SetEvent', 'ASM_API_GetDesktopWindow',
                  'ASM_API_SetBkColor', 'ASM_API_GetDlgItem', 'ASM_API_SetFileAttributesA', 'ASM_API_IsWindowEnabled',
                  'ASM_API_SetWindowTextA', 'ASM_API_SetBkMode', 'ASM_API_ScreenToClient', 'ASM_API_GetSystemInfo',
                  'ASM_API_TlsFree', 'ASM_API_GetKeyboardType', 'ASM_API_SystemParametersInfoA',
                  'ASM_API_CreateCompatibleDC', 'ASM_API_GetParent', 'ASM_API_EnableMenuItem', 'ASM_API_PostMessageA',
                  'ASM_API_GetDiskFreeSpaceA', 'ASM_API_LoadIconA', 'ASM_API_UpdateWindow',
                  'ASM_API_GetWindowThreadProcessId', 'ASM_API_GetLocalTime', 'ASM_API_lstrcmpA',
                  'ASM_API_GetStockObject', 'ASM_API_LoadBitmapA', 'ASM_API_GetWindow', 'ASM_API_FormatMessageA',
                  'ASM_API_CoInitialize', 'ASM_API_RegDeleteKeyA', 'ASM_API_GetClipBox', 'ASM_API_IsDialogMessageA',
                  'ASM_API_SetMenu', 'ASM_API_WinExec', 'ASM_API__CIsqrt', 'ASM_API_GetCurrentDirectoryA',
                  'ASM_API_IntersectRect', 'ASM_API_GlobalAddAtomA', 'ASM_API__CIsin', 'ASM_API_MapViewOfFile',
                  'ASM_API_StretchBlt', 'ASM_API__CIlog', 'ASM_API___p__fmode', 'ASM_API__CIexp', 'ASM_API__CIatan',
                  'ASM_API__adj_fdiv_m64', 'ASM_API__CItan', 'ASM_API__adj_fdiv_m32', 'ASM_API__adj_fprem1',
                  'ASM_API__adj_fptan', 'ASM_API__adj_fprem', 'ASM_API__adj_fdiv_r', 'ASM_API__adj_fdivr_m16i',
                  'ASM_API__adj_fpatan', 'ASM_API__adj_fdivr_m64', 'ASM_API_GetPropA', 'ASM_API__adj_fdivr_m32',
                  'ASM_API__adj_fdiv_m32i', 'ASM_API__adj_fdivr_m32i', 'ASM_API_RegEnumKeyA',
                  'ASM_API___vbaFPException', 'ASM_API__adj_fdiv_m16i', 'ASM_API___vbaChkstk', 'ASM_API_CompareStringW',
                  'ASM_API_GetTimeZoneInformation', 'ASM_API_AdjustTokenPrivileges', 'ASM_API___vbaFreeVar',
                  'ASM_API_RectVisible', 'ASM_API___getmainargs', 'ASM_API_sprintf',
                  'ASM_API_SHGetSpecialFolderLocation', 'ASM_API_RedrawWindow', 'ASM_API___vbaFreeStr',
                  'ASM_API___vbaHresultCheckObj', 'ASM_API_WindowFromPoint', 'ASM_API_EnumCalendarInfoA',
                  'ASM_API_RemovePropA', 'ASM_API___vbaStrMove', 'ASM_API_EqualRect', 'ASM_API__XcptFilter',
                  'ASM_API___vbaFreeVarList', 'ASM_API_ExpandEnvironmentStringsA', 'ASM_API___vbaFreeStrList',
                  'ASM_API_GetSysColorBrush', 'ASM_API_ImageList_SetIconSize', 'ASM_API_LoadImageA',
                  'ASM_API_GetComputerNameA', 'ASM_API_UnmapViewOfFile', 'ASM_API_CreateDIBSection', 'ASM_API_MoveToEx',
                  'ASM_API___setusermatherr', 'ASM_API___vbaNew2', 'ASM_API__exit', 'ASM_API_SetEnvironmentVariableA',
                  'ASM_API_DrawEdge', 'ASM_API___vbaStrCat', 'ASM_API___p__commode', 'ASM_API___vbaStrCopy',
                  'ASM_API_IsRectEmpty', 'ASM_API___vbaFreeObj', 'ASM_API_SetStretchBltMode', 'ASM_API__onexit',
                  'ASM_API_IsZoomed', 'ASM_API_GetIconInfo', 'ASM_API_CreatePalette', 'ASM_API_CharLowerA',
                  'ASM_API_SHGetPathFromIDListA', 'ASM_API_GlobalFindAtomA', 'ASM_API_RegOpenKeyA',
                  'ASM_API_CreateDIBitmap', 'ASM_API_GetKeyboardState', 'ASM_API_LookupPrivilegeValueA',
                  'ASM_API__controlfp', 'ASM_API_strstr', 'ASM_API_GetDlgItemTextA', 'ASM_API___vbaStrVarMove',
                  'ASM_API___vbaSetSystemError', 'ASM_API_DeleteMenu', 'ASM_API_LoadLibraryW',
                  'ASM_API_IsValidCodePage', 'ASM_API_CharPrevA', 'ASM_API_GetTextExtentPoint32A',
                  'ASM_API_CreateToolhelp32Snapshot', 'ASM_API_CharToOemA', 'ASM_API_DestroyCursor',
                  'ASM_API_RegisterClipboardFormatA', 'ASM_API___vbaOnError', 'ASM_API_GetStringTypeExA',
                  'ASM_API_CreateMenu', 'ASM_API_DrawIconEx', 'ASM_API_EnumThreadWindows', 'ASM_API_SetWindowOrgEx',
                  'ASM_API_DrawMenuBar', 'ASM_API_GetDriveTypeA', 'ASM_API_WinHelpA', 'ASM_API_SetScrollPos',
                  'ASM_API_SHFileOperationA', 'ASM_API_VariantInit', 'ASM_API_FrameRect', 'ASM_API___vbaLenBstr',
                  'ASM_API_ShowOwnedPopups', 'ASM_API___vbaVarDup', 'ASM_API___dllonexit', 'ASM_API_SHGetFileInfoA',
                  'ASM_API_atoi', 'ASM_API_GetScrollPos', 'ASM_API_AppendMenuA', 'ASM_API_SetPixel',
                  'ASM_API___vbaVarMove', 'ASM_API_ExcludeClipRect', 'ASM_API_strncpy', 'ASM_API_SetROP2',
                  'ASM_API_GetTextMetricsA', 'ASM_API_GetDCEx', 'ASM_API_CreateDialogParamA',
                  'ASM_API_DrawFrameControl', 'ASM_API_SetWindowPlacement', 'ASM_API___CxxFrameHandler',
                  'ASM_API_??2@YAPAXI@Z', 'ASM_API_MapVirtualKeyA', 'ASM_API___vbaErrorOverflow', 'ASM_API_OemToCharA',
                  'ASM_API_WaitMessage', 'ASM_API_InternetOpenUrlA', 'ASM_API_GetKeyboardLayout',
                  'ASM_API_FileTimeToDosDateTime', 'ASM_API_RemoveMenu', 'ASM_API_SafeArrayCreate',
                  'ASM_API___vbaAryDestruct', 'ASM_API_SetScrollRange', 'ASM_API_GetVolumeInformationA',
                  'ASM_API___vbaStrCmp', 'ASM_API_FileTimeToSystemTime', 'ASM_API_ImageList_Remove',
                  'ASM_API_ScrollWindow', 'ASM_API_SetScrollInfo', 'ASM_API_RegEnumKeyExA', 'ASM_API_GetCursor',
                  'ASM_API_IntersectClipRect', 'ASM_API_GetScrollRange', 'ASM_API_GetClipboardData',
                  'ASM_API_GetSystemPaletteEntries', 'ASM_API_SafeArrayGetUBound', 'ASM_API_CheckDlgButton',
                  'ASM_API_CompareFileTime', 'ASM_API_GetMenuItemInfoA', 'ASM_API_CreateIcon',
                  'ASM_API_SetThreadLocale', 'ASM_API_InsertMenuItemA', 'ASM_API_CreateFileMappingA',
                  'ASM_API_SafeArrayGetLBound', 'ASM_API_ImageList_Draw', 'ASM_API_InsertMenuA',
                  'ASM_API_Process32Next', 'ASM_API_SHBrowseForFolderA', 'ASM_API_ReleaseMutex',
                  'ASM_API___vbaStrToAnsi', 'ASM_API_WriteProcessMemory', 'ASM_API_SetBrushOrgEx',
                  'ASM_API_ShowScrollBar', 'ASM_API_SendMessageTimeoutA', 'ASM_API_Process32First',
                  'ASM_API___vbaFileOpen', 'ASM_API_MsgWaitForMultipleObjects', 'ASM_API_GetScrollInfo',
                  'ASM_API_GetBitmapBits', 'ASM_API___vbaFileClose', 'ASM_API_strlen', 'ASM_API_GetPaletteEntries',
                  'ASM_API_ImageList_DragEnter', 'ASM_API_MessageBeep', 'ASM_API_TranslateMDISysAccel',
                  'ASM_API_ActivateKeyboardLayout', 'ASM_API_GetWindowOrgEx', 'ASM_API___vbaObjSet',
                  'ASM_API_GetMenuStringA', 'ASM_API_CreateHalftonePalette', 'ASM_API_GetFileTime',
                  'ASM_API_GetDIBColorTable', 'ASM_API_ImageList_EndDrag', 'ASM_API_ImageList_GetIconSize',
                  'ASM_API_GetCurrentPositionEx', 'ASM_API_SetDIBColorTable', 'ASM_API___vbaVarCat',
                  'ASM_API_ImageList_DragLeave', 'ASM_API_CloseServiceHandle', 'ASM_API_ImageList_SetBkColor',
                  'ASM_API_RegFlushKey', 'ASM_API_EnableScrollBar', 'ASM_API_ImageList_DragMove', 'ASM_API__acmdln',
                  'ASM_API_ImageList_DrawEx', 'ASM_API_SetParent', 'ASM_API___vbaStrVarVal',
                  'ASM_API_ImageList_GetImageCount', 'ASM_API_ImageList_BeginDrag', 'ASM_API_SearchPathA',
                  'ASM_API_GetKeyNameTextA', 'ASM_API_ImageList_DragShowNolock', 'ASM_API_ImageList_Read',
                  'ASM_API_GetKeyboardLayoutList', 'ASM_API_MoveWindow', 'ASM_API_RegOpenKeyExW',
                  'ASM_API___vbaStrToUnicode', 'ASM_API_GetConsoleCP', 'ASM_API_CreatePenIndirect',
                  'ASM_API_RegQueryValueExW', 'ASM_API_RegQueryInfoKeyA', 'ASM_API_DefFrameProcA',
                  'ASM_API_GetBrushOrgEx', 'ASM_API_ImageList_ReplaceIcon', 'ASM_API_GetUserDefaultLCID',
                  'ASM_API___vbaGenerateBoundsError', 'ASM_API_strchr', 'ASM_API_GetConsoleMode', 'ASM_API___vbaEnd',
                  'ASM_API_SetThreadPriority', 'ASM_API_GetCommandLineW', 'ASM_API_DefMDIChildProcA',
                  'ASM_API__stricmp', 'ASM_API___vbaI4Var', 'ASM_API_SetMenuItemInfoA', 'ASM_API_ImageList_GetBkColor',
                  'ASM_API_ImageList_AddMasked', 'ASM_API_ImageList_Write', 'ASM_API_MaskBlt', 'ASM_API_GetDCOrgEx',
                  'ASM_API_CharLowerBuffA', 'ASM_API_RegisterClassExA', 'ASM_API_ShowCursor',
                  'ASM_API_VariantChangeTypeEx', 'ASM_API_SetMapMode', 'ASM_API_IsBadWritePtr',
                  'ASM_API_DuplicateHandle', 'ASM_API_URLDownloadToFileA', 'ASM_API_InitCommonControls',
                  'ASM_API_GetConsoleOutputCP', 'ASM_API_strcpy', 'ASM_API_WriteConsoleW',
                  'ASM_API_ImageList_GetDragImage', 'ASM_API_VariantChangeType', 'ASM_API_Rectangle',
                  'ASM_API_LoadKeyboardLayoutA', 'ASM_API_WriteConsoleA', 'ASM_API___vbaFreeObjList',
                  'ASM_API___vbaUbound', 'ASM_API_CoTaskMemAlloc', 'ASM_API_strrchr', 'ASM_API_GetExitCodeThread',
                  'ASM_API_FindFirstFileW', 'ASM_API___vbaAryMove', 'ASM_API_ProcCallEngine', 'ASM_API___vbaAryUnlock',
                  'ASM_API___vbaRedim', 'ASM_API_TerminateThread', 'ASM_API_OpenSCManagerA', 'ASM_API_CopyRect',
                  'ASM_API_CreateStreamOnHGlobal', 'ASM_API_WSACleanup', 'ASM_API_ImageList_SetDragCursorImage',
                  'ASM_API___vbaInStr', 'ASM_API_MessageBoxW', 'ASM_API_fclose', 'ASM_API_OpenServiceA',
                  'ASM_API_CharUpperBuffA', 'ASM_API_??3@YAXPAX@Z', 'ASM_API_InitializeCriticalSectionAndSpinCount',
                  'ASM_API_rand', 'ASM_API_MethCallEngine', 'ASM_API___vbaI2I4', 'ASM_API_SystemTimeToFileTime',
                  'ASM_API___vbaAryLock', 'ASM_API_GetFileAttributesW', 'ASM_API_ReadProcessMemory',
                  'ASM_API___vbaFpI4', 'ASM_API_strcat', 'ASM_API_RegSetValueExW', 'ASM_API_GetLocaleInfoW',
                  'ASM_API___vbaVar2Vec', 'ASM_API_VirtualAllocEx', 'ASM_API_DeleteFileW', 'ASM_API_GetMessageTime',
                  'ASM_API_SendMessageW', 'ASM_API___vbaVarTstEq', 'ASM_API_PostThreadMessageA',
                  'ASM_API_CLSIDFromString', 'ASM_API_fopen', 'ASM_API_InterlockedCompareExchange',
                  'ASM_API_RegCreateKeyA', 'ASM_API_OutputDebugStringA', 'ASM_API_strcmp',
                  'ASM_API_MessageBoxIndirectA', 'ASM_API_StartServiceA', 'ASM_API_PlayEnhMetaFile',
                  'ASM_API_SHGetMalloc', 'ASM_API_DeleteEnhMetaFile', 'ASM_API_SendDlgItemMessageA',
                  'ASM_API_CharUpperA', 'ASM_API___vbaAryConstruct2', 'ASM_API_GetEnhMetaFileHeader',
                  'ASM_API___vbaVarAdd', 'ASM_API_SetEnhMetaFileBits', 'ASM_API___vbaObjSetAddref',
                  'ASM_API_GetEnhMetaFileBits', 'ASM_API_LoadStringW', 'ASM_API_SetWinMetaFileBits',
                  'ASM_API_GetWinMetaFileBits', 'ASM_API___vbaVarVargNofree', 'ASM_API_ExtTextOutA',
                  'ASM_API_GetEnhMetaFilePaletteEntries', 'ASM_API_IsBadCodePtr', 'ASM_API_OpenMutexA',
                  'ASM_API___vbaStrI4', 'ASM_API___vbaVarCopy', 'ASM_API_CopyEnhMetaFileA', 'ASM_API_LocalReAlloc',
                  'ASM_API_srand', 'ASM_API___vbaAryCopy', 'ASM_API_CreateDCA']

    with open(output_filepath, "w") as output_file:
        writer = csv.DictWriter(output_file, fieldnames=fieldnames)
        writer.writeheader()
        i = 0
        filenames = os.listdir(pe_filepath)
        for filename in filenames:
            asm_parser = AssemblyParser()
            print("{};{}".format(i,pe_filepath+filename))
            asm_parser.load_asm_file(pe_filepath+filename)
            api_features = asm_parser.extract_API_features()
            api_features['Id'] = filename[:-4]
            writer.writerow({feature_name: api_features[feature_name] for feature_name in fieldnames})
            i+=1